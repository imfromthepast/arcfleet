<apex:page docType="html-5.0" controller="TerritoryMapController" standardstylesheets="true" showheader="false">
    <apex:composition template="territorytemplate">
        <apex:define name="javascript">
            <script>
                function geocode(){
                    var geocoder = new google.maps.Geocoder();
                    address = "{!kingdomhall.Address__c}";
                    geocoder.geocode({address:address}, function(results, status){
                        if(status == google.maps.GeocoderStatus.OK && results.length){
                            if(status != google.maps.GeocoderStatus.ZERO_RESULTS){
                                color = getColor('{!if(isinwindow,territory.covered_in_campaign__c,false)}','{!territory.checked_out__c}');
                                color='blue';
                                var showMarkers = false;
                                plotTerritory('{!territory.id}','{!territory.name}',$j("[id$='coords']").val(),'viewCong',color,'#c5c5c5', showMarkers, '{!if(territory.marker_coords__c == null,"none",territory.marker_coords__c)}',true,24,'{!congregation.id}');
                                kingdomHall.setPosition(results[0].geometry.location);
                                kingdomHall.setMap(map);
                                map.mapTypeControl = false;
                                map.panControl = false;
                                map.zoomControl = false;
                            }else{
                                $j('#map_edit').css({'height' : '15px'});
                                $j('#map_edit').html("Oops!");
                            }
                        } else {
                            $j('#map_edit').css({'height' : '15px'});
                            $j('#map_edit').html("Oops! Territory #{!territory.Name}'s Kingdom Hall address could not be found, please make sure the address is correct."+address);
                        }
                    });
                }
            </script>
            
            <script type="text/javascript">
                $j = jQuery.noConflict();
                $j(document).ready(function() {
                    $j("[id$='coveredCheck']").button();
                    var linkLocation = '';
                    $j("body").css("display", "none");
                    $j("body").fadeIn(2000);
                    function redirectPage() {
                        window.location = linkLocation;
                    }
                    var i = 0;
                    var char = '';
                    document.onkeypress=function(e){
                        i++;
                        var e=window.event || e;
                        char = char + String.fromCharCode(e.charCode);
                        e.preventDefault();
                        if(i == 1){
                            if(char == 'b'){
                                i=0;
                                char = 'b';
                            }
                        }
                        if(i == 2){
                            if(char == '00'){
                                linkLocation = '../apex/congregationmap2?id={!congregation.id}';
                                $j("body").fadeOut(1000, redirectPage);
                            }else{
                                linkLocation = '../apex/territorymap2?id={!congregation.id}&ks=' + char;
                                $j("body").fadeOut(1000, redirectPage);
                            }
                            i=0;
                        }
                    }
                });
            </script>
        </apex:define>
        <apex:define name="toolbartitle">
            Territory #{!territory.name} {!if(ismobile,'',' - Enter 00 on the keypad to return to '+congregation.name+' map.')}
        </apex:define>
        <apex:define name="content">
            <apex:form >
                <apex:inputhidden id="coords" value="{!territory.Coordinates__c}"/>
            </apex:form>
            <!--c:mapLegend unassigned="{!congregation.Unassigned_Territories__c}" assigned="{!congregation.Assigned_Territories__c}" covered="{!congregation.Percentage_Covered__c}" ismobile="{!ismobile}"/-->
            <div id="map_edit" style="width: 100%; height: 100%; border-left:1px black solid;"></div>
        </apex:define>
    </apex:composition>
</apex:page>